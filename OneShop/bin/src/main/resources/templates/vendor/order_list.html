<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{vendor/layout/app}">
<head>
    <title>Quản lý Đơn hàng</title>
    <style>
        .nav-tabs { border-bottom: 1px solid #dee2e6; }
        .nav-tabs .nav-link {
            color: var(--text-muted); font-weight: 500;
            border: 1px solid transparent; border-bottom: none;
        }
        .nav-tabs .nav-link.active, .nav-tabs .nav-item.show .nav-link {
            color: #fff; background-color: var(--primary-color);
            border-color: #dee2e6 #dee2e6 #fff;
            font-weight: 600;
            border-top-left-radius: 0.375rem;
            border-top-right-radius: 0.375rem;
        }
        .nav-tabs .nav-link:hover:not(.active) {
            border-color: #e9ecef #e9ecef #dee2e6;
            background-color: #f8f9fa;
        }
    </style>
</head>
<body>
<div layout:fragment="content">
    <h1 class="h3 mt-4">Quản lý Đơn hàng</h1>
    <p class="lead mb-4">Theo dõi và quản lý tất cả đơn hàng cho gian hàng của bạn.</p>

    <div class="card shadow">
        <div class="card-header p-0 bg-white border-bottom-0">
            
            <ul class="nav nav-tabs nav-fill" id="orderStatusTabs" role="tablist">
                <li class="nav-item" role="presentation">
                    <a class="nav-link" th:href="@{/vendor/orders}" 
                       th:classappend="${param.status == null || #strings.isEmpty(param.status)} ? 'active' : ''">Tất cả</a>
                </li>
                <li class="nav-item" role="presentation">
                    <a class="nav-link" th:href="@{/vendor/orders(status='new')}" 
                       th:classappend="${param.status == 'new'} ? 'active' : ''">Chờ xác nhận</a>
                </li>
                <li class="nav-item" role="presentation">
                    <a class="nav-link" th:href="@{/vendor/orders(status='confirmed')}" 
                       th:classappend="${param.status == 'confirmed'} ? 'active' : ''">Chờ lấy hàng</a>
                </li>
                <li class="nav-item" role="presentation">
                    <a class="nav-link" th:href="@{/vendor/orders(status='shipping')}" 
                       th:classappend="${param.status == 'shipping'} ? 'active' : ''">Đang giao</a>
                </li>
                 <li class="nav-item" role="presentation">
                    <a class="nav-link" th:href="@{/vendor/orders(status='delivered')}" 
                       th:classappend="${param.status == 'delivered'} ? 'active' : ''">Đã giao</a>
                </li>
                 <li class="nav-item" role="presentation">
                    <a class="nav-link" th:href="@{/vendor/orders(status='cancelled')}" 
                       th:classappend="${param.status == 'cancelled'} ? 'active' : ''">Đã hủy</a>
                </li>
                 <li class="nav-item" role="presentation">
                    <a class="nav-link" th:href="@{/vendor/orders(status='returned')}" 
                       th:classappend="${param.status == 'returned'} ? 'active' : ''">Trả hàng/Hoàn tiền</a>
                </li>
            </ul>
        </div>
        
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-hover align-middle" width="100%" cellspacing="0">
                    <thead class="table-light">
                        <tr>
                            <th>Mã đơn hàng</th>
                            <th>Khách hàng</th>
                            <th>Ngày đặt</th>
                            <th>Tổng tiền</th>
                            <th>Trạng thái</th>
                            <th class="text-center">Hành động</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr th:each="order : ${orderPage.content}">
                            <td th:text="${'#' + order.id}">#12348</td>
                            <td th:text="${order.customerName}">Phạm Minh Dũng</td>
                            <td th:text="${#temporals.format(order.orderDate, 'dd/MM/yyyy')}">15/10/2025</td>
                            <td th:text="${#numbers.formatCurrency(order.totalAmount)}">502.000₫</td>
                            <td>
                                <span th:switch="${order.status.name()}">
                                    <span th:case="'NEW'" class="badge bg-secondary">Chờ xác nhận</span>
                                    <span th:case="'CONFIRMED'" class="badge bg-primary">Chờ lấy hàng</span>
                                    <span th:case="'SHIPPING'" class="badge bg-warning text-dark">Đang giao</span>
                                    <span th:case="'DELIVERED'" class="badge bg-success">Đã giao</span>
                                    <span th:case="'CANCELLED'" class="badge bg-danger">Đã hủy</span>
                                    <span th:case="'RETURNED'" class="badge bg-dark">Trả hàng</span>
                                </span>
                            </td>
                            <td class="text-center">
                                <a th:href="@{/vendor/orders/details/{id}(id=${order.id})}" class="btn btn-sm btn-outline-primary">Xem chi tiết</a>
                            </td>
                        </tr>
                        <tr th:if="${orderPage.empty}">
                            <td colspan="6" class="text-center">Không tìm thấy đơn hàng nào.</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <nav class="d-flex justify-content-center mt-3" th:if="${!orderPage.empty && orderPage.totalPages > 1}">
              <ul class="pagination">
                <li class="page-item" th:classappend="${orderPage.first} ? 'disabled' : ''">
                    <a class="page-link" th:href="@{/vendor/orders(status=${param.status}, page=${orderPage.number - 1})}">Trước</a>
                </li>
                <li class="page-item active">
                    <a class="page-link" href="#" th:text="${orderPage.number + 1}">1</a>
                </li>
                <li class="page-item" th:classappend="${orderPage.last} ? 'disabled' : ''">
                    <a class="page-link" th:href="@{/vendor/orders(status=${param.status}, page=${orderPage.number + 1})}">Sau</a>
                </li>
              </ul>
            </nav>
        </div>
    </div>
</div>
</body>
</html>