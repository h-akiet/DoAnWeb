<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/guest}">
<head>
    <meta charset="UTF-8">
    <title>Tin Tức & Ưu Đãi</title>
    <th:block layout:fragment="css">
        <link rel="stylesheet" type="text/css" th:href="@{/assets/css/new.css}">
        <link rel="stylesheet" th:href="@{/assets/css/common.css}">
        <style>
            /* Thêm style cho tiêu đề phần */
            .section-title {
                font-size: 24px;
                font-weight: 600;
                color: #333;
                margin-top: 20px;
                margin-bottom: 20px;
                padding-bottom: 10px;
                border-bottom: 2px solid var(--primary-color, #E85A70);
                display: inline-block;
            }
            /* Style cho ảnh sản phẩm/shop trong tin tức */
            .new-item__img img {
                width: 100%;
                height: 225px; /* Giữ chiều cao cố định */
                object-fit: cover; /* Đảm bảo ảnh đầy đủ, không bị méo */
            }
            .no-news-message {
                text-align: center;
                font-size: 1.1rem;
                color: #777;
                padding: 40px 0;
            }
            /* Style cho mô tả khuyến mãi */
             .promo-description strong {
                 color: var(--primary-color, #E85A70);
                 font-weight: 600;
             }
             .promo-description {
                 color: #555;
             }
             /* === CSS CHO PHÂN TRANG === */
            .pagination-wrapper {
                 display: flex;
                 justify-content: center;
                 margin-top: 20px;
                 padding-bottom: 20px;
            }
            .pagination {
                padding-left: 0;
                list-style: none;
                border-radius: 0.25rem;
                display: flex;
            }
            .page-item {
                margin: 0 3px;
            }
            .page-item .page-link {
                position: relative;
                display: block;
                padding: 0.5rem 0.75rem;
                margin-left: -1px;
                line-height: 1.25;
                color: var(--primary-color, #E85A70);
                background-color: #fff;
                border: 1px solid #dee2e6;
                text-decoration: none;
                border-radius: 0.25rem;
            }
            .page-item .page-link:hover {
                z-index: 2;
                color: var(--secondary-color, #f07b8d);
                background-color: #e9ecef;
                border-color: #dee2e6;
            }
            .page-item.active .page-link {
                z-index: 3;
                color: #fff;
                background-color: var(--primary-color, #E85A70);
                border-color: var(--primary-color, #E85A70);
            }
            .page-item.disabled .page-link {
                color: #6c757d;
                pointer-events: none;
                cursor: auto;
                background-color: #fff;
                border-color: #dee2e6;
            }
            /* === KẾT THÚC CSS PHÂN TRANG === */
        </style>
    </th:block>
</head>

<body>
    <div class="main" layout:fragment="content">
        <div class="grid wide">
            <div class="main__taskbar">
                <div class="main__breadcrumb">
                    <div class="breadcrumb__item">
                        <a th:href="@{/}" class="breadcrumb__link">Trang chủ</a>
                    </div>
                    <div class="breadcrumb__item">
                        <a th:href="@{/news}" class="breadcrumb__link">Tin tức & Ưu đãi</a>
                    </div>
                </div>
            </div>

             <div th:if="${errorMessage}" class="alert alert-danger" role="alert" th:text="${errorMessage}"></div>

            <h2 class="section-title">Ưu đãi mới nhất</h2>
            
            <div th:if="${promotionPage == null or promotionPage.empty}" class="no-news-message">
                <p>Chưa có ưu đãi nào mới.</p>
            </div>

            <div class="list-new" th:if="${promotionPage != null and not promotionPage.empty}">
                <div class="new-item" th:each="promo : ${promotionPage.content}">
                    <a th:href="@{/products}" class="new-item__img">
                        <img th:src="${promo.shop?.banner != null and !#strings.isEmpty(promo.shop.banner)} 
                                     ? @{'/uploads/images/' + ${promo.shop.banner}} 
                                     : @{/assets/img/slider/slide-6.jpg}" 
                             alt="Promotion Banner">
                    </a>
                    <div class="new-item__body">
                        <a th:href="@{/products}" class="new-item__title" th:text="${promo.campaignName}">
                            Tên chiến dịch khuyến mãi
                        </a>
                        <p class="new-item__time" 
                           th:text="'Áp dụng từ: ' + ${#temporals.format(promo.startDate, 'dd/MM/yyyy')} + ' đến ' + ${#temporals.format(promo.endDate, 'dd/MM/yyyy')}">
                            Ngày áp dụng
                        </p>
                        <p class="new-item__description promo-description">
                            Mã <strong>'[[${promo.discountCode}]]'</strong>
                            <span th:text="${' - ' + promo.type.name}"></span>
                            <span th:if="${promo.value != null and promo.type.code == 'PERCENTAGE'}" th:text="' - Giảm ' + ${#numbers.formatDecimal(promo.value, 0, 'COMMA', 0, 'POINT')} + '%'"></span>
                            <span th:if="${promo.value != null and promo.type.code == 'FIXED_AMOUNT'}" th:text="' - Giảm ' + ${#numbers.formatCurrency(promo.value)}"></span>
                            <br>
                            </p>
                        <a th:href="@{/products}" class="btn btn--default">Săn Sale Ngay</a>
                    </div>
                </div>
            </div>
            <nav class="pagination-wrapper" aria-label="Promotion Pagination" th:if="${promotionPage != null and promotionPage.totalPages > 1}">
                <ul class="pagination">
                    <li class="page-item" th:classappend="${promotionPage.first} ? 'disabled' : ''">
                        <a class="page-link" th:href="@{/news(promoPage=${promotionPage.number - 1}, productPage=${currentProductPage})}">&laquo;</a>
                    </li>
                    <li class="page-item" th:each="pageNumber : ${#numbers.sequence(0, promotionPage.totalPages - 1)}"
                        th:classappend="${pageNumber == promotionPage.number} ? 'active' : ''">
                        <a class="page-link" th:href="@{/news(promoPage=${pageNumber}, productPage=${currentProductPage})}" th:text="${pageNumber + 1}">1</a>
                    </li>
                    <li class="page-item" th:classappend="${promotionPage.last} ? 'disabled' : ''">
                         <a class="page-link" th:href="@{/news(promoPage=${promotionPage.number + 1}, productPage=${currentProductPage})}">&raquo;</a>
                    </li>
                </ul>
            </nav>
            <h2 class="section-title" style="margin-top: 40px;">Sản phẩm mới lên kệ</h2>

            <div th:if="${newestProductPage == null or newestProductPage.empty}" class="no-news-message">
                <p>Chưa có sản phẩm nào mới.</p>
            </div>
            
            <div class="list-new" th:if="${newestProductPage != null and not newestProductPage.empty}">
                <div class="new-item" th:each="product : ${newestProductPage.content}">
                    <a th:href="@{/product/{id}(id=${product.productId})}" class="new-item__img">
                        <img th:src="@{${product.primaryImageUrl}}" alt="Product Image">
                    </a>
                    <div class="new-item__body">
                        <a th:href="@{/product/{id}(id=${product.productId})}" class="new-item__title" th:text="${product.name}">
                            Tên sản phẩm mới
                        </a>
                        <p class="new-item__time" th:text="'Cửa hàng: ' + ${product.shop?.name ?: 'N/A'}">
                            Tên cửa hàng
                        </p>
                        <p class="new-item__description" 
                           th:text="${product.description != null ? #strings.abbreviate(product.description, 200) : 'Sản phẩm mới có mặt tại OneShop.'}">
                           Mô tả sản phẩm...
                        </p>
                        <a th:href="@{/product/{id}(id=${product.productId})}" class="btn btn--default">Xem chi tiết</a>
                    </div>
                </div>
            </div>
             <nav class="pagination-wrapper" aria-label="Product Pagination" th:if="${newestProductPage != null and newestProductPage.totalPages > 1}">
                <ul class="pagination">
                    <li class="page-item" th:classappend="${newestProductPage.first} ? 'disabled' : ''">
                        <a class="page-link" th:href="@{/news(promoPage=${currentPromoPage}, productPage=${newestProductPage.number - 1})}">&laquo;</a>
                    </li>
                    <li class="page-item" th:each="pageNumber : ${#numbers.sequence(0, newestProductPage.totalPages - 1)}"
                        th:classappend="${pageNumber == newestProductPage.number} ? 'active' : ''">
                        <a class="page-link" th:href="@{/news(promoPage=${currentPromoPage}, productPage=${pageNumber})}" th:text="${pageNumber + 1}">1</a>
                    </li>
                    <li class="page-item" th:classappend="${newestProductPage.last} ? 'disabled' : ''">
                        <a class="page-link" th:href="@{/news(promoPage=${currentPromoPage}, productPage=${newestProductPage.number + 1})}">&raquo;</a>
                    </li>
                </ul>
            </nav>
            </div>
    </div>
</body>
</html>