<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Quản lý Người dùng - Admin</title>
<link rel="preconnect" href="https://fonts.gstatic.com">
<link
	href="https://fonts.googleapis.com/css2?family=Roboto+Slab:wght@100;200;300;400;500;600;700;800;900&display=swap"
	rel="stylesheet">
<link rel="stylesheet"
	href="https://pro.fontawesome.com/releases/v5.10.0/css/all.css"
	integrity="sha384-AYmEC3Yw5cVb3ZcuHtOA93w35dYTsvhLPVnYs9eStHfGJvOvKxVfELGroGkvsg+p"
	crossorigin="anonymous" />
<link rel="stylesheet"
	th:href="@{/webjars/bootstrap/5.3.2/css/bootstrap.min.css}" />
<link rel="stylesheet" th:href="@{/assets/css/library.css}">
<link rel="stylesheet" th:href="@{/assets/css/common.css}">

<style>
.admin-container {
	padding-top: 50px;
	padding-bottom: 50px;
	min-height: 80vh;
}

.table th, .table td {
	vertical-align: middle;
}

.status-active {
	color: green;
	font-weight: 500;
}

.status-inactive {
	color: orange;
	font-weight: 500;
}

/* === BỔ SUNG ĐIỀU CHỈNH CÂN ĐỐI VÀ CHỮ TRÊN HEADER === */
/* Giảm kích thước chữ trên thanh điều hướng admin */
.header__nav-link {
	font-size: 14px;
	padding: 8px 12px;
}

/* Cố định kích thước các cột thao tác để bảng cân đối hơn */
.table th:nth-child(6), /* Cột Khóa/Mở khóa */ .table th:nth-child(7) {
	/* Cột Cấp/Đổi quyền */
	width: 150px;
	min-width: 120px;
}

/* Tăng font chữ và độ đậm cho tiêu đề cột */
.table thead th {
	font-size: 14px;
	font-weight: 700;
	color: #333;
	white-space: nowrap;
}
/* CSS MỚI ĐÃ SỬA ĐỔI */
.header__admin-info {
	/* Giữ nguyên: căn chỉnh icon và chữ Admin */
	display: flex;
	align-items: center;
	gap: 8px;
	/* Loại bỏ margin-right vì sẽ căn giữa dọc */
}

.header__admin-info i {
	font-size: 30px;
	color: #9e5bab;
}

.header__admin-info span {
	font-size: 18px;
	font-weight: 600;
	color: var(--black-cl-2);
}

.header__account-logout {
	font-size: 16px;
	color: #007bff !important;
	text-decoration: underline;
	transition: color 0.2s;
	white-space: nowrap;
}

.header__account-logout:hover {
	color: var(--default-cl) !important;
}

.header__top .header__account {
	display: flex;
	flex-direction: column;
	align-items: center;
	gap: 4px;
	padding-left: 15px;
}

.admin-container {
	padding-top: 15px; 
	padding-bottom: 50px;
	min-height: 80vh;
}

.breadcrumb-admin-static {
    font-size: 16px; 
    color: #444; 
    margin-bottom: 10px;
}
</style>
</head>

<body>

	<div th:replace="~{admin/fragments/header :: header}"></div>

	<div class="main admin-container">
		<div class="grid wide">
			<!-- <h2 class="category__heading" style="text-align: center;">Quản
				Lý Người Dùng</h2> -->
			<div class="breadcrumb-admin-static" style="padding: 20px 0;">
				<span class="breadcrumb-item-admin"
					style="font-weight: 500; text-transform: uppercase;">ADMIN</span> <span
					style="font-weight: 500; margin: 0 5px;">/</span> <span
					class="breadcrumb-item-admin"
					style="font-weight: 500; text-transform: uppercase;">QUẢN LÝ
					NGƯỜI DÙNG</span>
			</div>
			<div class="row mb-4">
				<div class="col-12">
					<form th:action="@{/admin/users}" method="get" class="d-flex">
						<input type="text" name="keyword" class="form-control me-2"
							th:value="${keyword}"
							placeholder="Tìm kiếm theo tên hoặc email..."
							style="max-width: 400px;">
						<button type="submit" class="btn btn--default">
							<i class="fas fa-search"></i> Tìm kiếm
						</button>
					</form>
				</div>
			</div>

			<div class="table-responsive">
				<table class="table table-hover table-bordered">
					<thead class="table-light">
						<tr>
							<th>ID</th>
							<th>Tên người dùng</th>
							<th>Email</th>
							<th>Quyền</th>
							<th>Trạng thái</th>
							<th>Khóa/Mở khóa</th>
							<th>Cấp/Đổi quyền</th>
						</tr>
					</thead>
					<tbody>
						<tr th:each="user : ${users}">
							<td th:text="${user.userId}">1</td>
							<td th:text="${user.username}">Nguyễn Văn A</td>
							<td th:text="${user.email}">user.a@example.com</td>
							<td><span th:each="role : ${user.roles}"
								th:text="${role.name}">USER</span></td>
							<td><span
								th:classappend="${user.activated ? 'status-active' : 'status-inactive'}"
								th:text="${user.activated ? 'ACTIVE' : 'INACTIVE'}">ACTIVE</span>
							</td>
							<td><a
								th:href="@{'/admin/users/toggle-status/' + ${user.id}}"
								class="btn btn-sm"
								th:classappend="${user.activated ? 'btn-danger' : 'btn-success'}"
								th:text="${user.activated ? 'Khóa' : 'Mở Khóa'}"
								onclick="return confirm('Bạn có chắc chắn muốn thực hiện thao tác này?');">
									Khóa/Mở Khóa </a></td>
							<td>
								<button type="button" class="btn btn-sm btn-info text-white"
									data-bs-toggle="modal"
									th:data-bs-target="'#changeRoleModal-' + ${user.id}">
									<i class="fas fa-user-tag"></i> Đổi Quyền
								</button>
							</td>
						</tr>


					</tbody>
				</table>
			</div>

		</div>
	</div>

	<div th:each="user : ${users}" class="modal fade"
		th:id="'changeRoleModal-' + ${user.id}" tabindex="-1"
		aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<form th:action="@{'/admin/users/change-role/' + ${user.id}}"
					method="post">
					<div class="modal-header">
						<h5 class="modal-title">
							Cấp/Đổi quyền cho <span th:text="${user.username}"></span>
						</h5>
						<button type="button" class="btn-close" data-bs-dismiss="modal"
							aria-label="Close"></button>
					</div>
					<div class="modal-body">
						<p>
							Quyền hiện tại: <strong
								th:text="${user.roles.stream().map(r -> r.name).findFirst().orElse('N/A')}"></strong>
						</p>
						<div class="form-group">
							<label th:for="'newRole-' + ${user.id}">Chọn quyền mới:</label> <select
								class="form-select" name="newRoleName"
								th:id="'newRole-' + ${user.id}" required>
								<option value="ADMIN">ADMIN</option>
								<option value="USER">USER</option>
								<option value="VENDOR">VENDOR</option>
								<option value="SHIPPER">SHIPPER</option>
							</select>
						</div>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-secondary"
							data-bs-dismiss="modal">Đóng</button>
						<button type="submit" class="btn btn-primary">Lưu Thay
							Đổi</button>
					</div>
				</form>
			</div>
		</div>
	</div>

	<div th:replace="~{admin/fragments/footer :: footer}"></div>

	<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
	<script th:src="@{/webjars/bootstrap/5.3.2/js/bootstrap.bundle.min.js}"></script>
	<script th:src="@{/assets/js/commonscript.js}"></script>

</body>

</html>