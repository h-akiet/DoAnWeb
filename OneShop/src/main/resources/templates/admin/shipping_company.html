<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Quản lý Nhà vận chuyển - Admin</title>
<link rel="preconnect" href="https://fonts.gstatic.com">
<link
	href="https://fonts.googleapis.com/css2?family=Roboto+Slab:wght@100;200;300;400;500;600;700;800;900&display=swap"
	rel="stylesheet">
<link rel="stylesheet"
	href="https://pro.fontawesome.com/releases/v5.10.0/css/all.css"
	integrity="sha384-AYmEC3Yw5cVb3ZcuHtOA93w35dYTsvhLPVnYs9eStHfGJvOvKxVfELGroGkvsg+p"
	crossorigin="anonymous" />
<link rel="stylesheet"
	th:href="@{/webjars/bootstrap/5.3.2/css/bootstrap.min.css}" />
<link rel="stylesheet" th:href="@{/assets/css/library.css}">
<link rel="stylesheet" th:href="@{/assets/css/common.css}">
<link rel="stylesheet" th:href="@{/assets/css/admin/user.css}">
</head>

<body>

	<div th:replace="~{admin/fragments/header :: header}"></div>

	<div class="main admin-container">
		<div class="grid wide">
			<div class="breadcrumb-admin-static" style="padding: 20px 0;">
				<span class="breadcrumb-item-admin"
					style="font-weight: 500; text-transform: uppercase;">ADMIN</span> <span
					style="font-weight: 500; margin: 0 5px;">/</span> <span
					class="breadcrumb-item-admin"
					style="font-weight: 500; text-transform: uppercase;">QUẢN LÝ
					NHÀ VẬN CHUYỂN</span>
			</div>
			<div class="d-flex justify-content-end mb-3">
				<button type="button" class="btn btn-secondary"
					data-bs-toggle="modal" data-bs-target="#addShippingCompanyModal"
					id="btnAddCompany"
					style="background-color: #6c757d !important; color: #fff !important; font-size: 16px; font-weight: 600; padding: 8px 15px;">
					<i class="fas fa-plus"></i> Thêm Nhà Vận Chuyển
				</button>
			</div>

			<div class="modal fade" id="addShippingCompanyModal" tabindex="-1"
				aria-labelledby="addShippingCompanyModalLabel" aria-hidden="true">
				<div class="modal-dialog modal-lg">
					<div class="modal-content">
						<form th:action="@{/admin/shipping-companies/save}" method="post"
							th:object="${newShippingCompany}">
							<div class="modal-body">

								<h1 class="text-primary mb-3"
									style="font-size: 2rem !important; font-weight: 700 !important;">
									Thông tin Nhà Vận Chuyển</h1>
								<div class="mb-3">
									<label for="companyName" class="form-label">Tên Nhà Vận
										Chuyển:</label> <input type="text" class="form-control"
										id="companyName" th:field="*{name}" required
										placeholder="Nhập tên nhà vận chuyển..."
										style="font-size: 14px;">
								</div>

								<div class="row">
									<div class="col-md-12 mb-3">
										<label for="companyPhone" class="form-label">Số Điện
											Thoại:</label> <input type="text" class="form-control"
											id="companyPhone" th:field="*{phone}" required
											placeholder="Nhập số điện thoại liên hệ..."
											style="font-size: 14px;">
									</div>

								</div>

								<h1 class="text-primary mb-3 mt-4"
									style="font-size: 2rem !important; font-weight: 700 !important; display: flex; align-items: center;">
									Quy tắc tính phí
									<button type="button" class="btn btn-sm btn-success ms-2"
										id="btnAddRule" style="font-size: 12px;">
										<i class="fas fa-plus"></i> Thêm Quy tắc
									</button>
								</h1>

								<div id="rulesContainer" class="border p-3 rounded">
									<div th:if="${newShippingCompany.rules != null}"
										th:each="rule, i : *{rules}"
										class="rule-entry mb-3 p-3 border rounded bg-light"
										th:data-index="${i.index}">

										<div
											class="d-flex justify-content-between align-items-start mb-2">

											<h4 class="text-secondary" th:text="'Quy tắc #' + ${i.index}"
												style="font-size: 1.25rem; font-weight: 600;">Quy tắc
												#0</h4>

											<button type="button"
												class="btn btn-danger btn-sm btnRemoveRule"
												title="Xóa quy tắc này">
												<i class="fas fa-times"></i>
											</button>
										</div>

										<div class="row g-2">
											<div class="col-12 mb-2">
												<input type="text" class="form-control form-control-sm"
													th:name="'rules[' + ${i.index} + '].ruleName'" required
													placeholder="Tên quy tắc (VD: Phí Nội Thành)"
													style="font-size: 14px;"
													th:field="*{rules[__${i.index}__].ruleName}">
											</div>

											<div class="col-md-6 mb-2">
												<input type="text" class="form-control form-control-sm"
													th:name="'rules[' + ${i.index} + '].estimatedDeliveryTime'"
													required placeholder="TG Giao hàng (VD: 1-2 ngày)"
													style="font-size: 14px;"
													th:field="*{rules[__${i.index}__].estimatedDeliveryTime}">
											</div>

											<div class="col-md-6 mb-2">
												<input type="number" step="0.01"
													class="form-control form-control-sm"
													th:name="'rules[' + ${i.index} + '].baseFee'" required
													placeholder="Phí (VD: 35000)" style="font-size: 14px;"
													th:field="*{rules[__${i.index}__].baseFee}">
											</div>

											<div class="col-md-4">
												<input type="text" class="form-control form-control-sm"
													th:name="'rules[' + ${i.index} + '].fromRegion'" required
													placeholder="Vùng Gửi (VD: HCM)" style="font-size: 14px;"
													th:field="*{rules[__${i.index}__].fromRegion}">
											</div>

											<div class="col-md-4">
												<input type="text" class="form-control form-control-sm"
													th:name="'rules[' + ${i.index} + '].toRegion'" required
													placeholder="Vùng Nhận (VD: Hà Nội)"
													style="font-size: 14px;"
													th:field="*{rules[__${i.index}__].toRegion}">
											</div>

											<div class="col-md-4 d-flex align-items-center">
												<div class="form-check form-check-inline">
													<input class="form-check-input" type="checkbox"
														th:name="'rules[' + ${i.index} + '].isExpress'"
														th:id="'isExpress_' + ${i.index}" value="true"
														th:field="*{rules[__${i.index}__].isExpress}"> <label
														class="form-check-label"
														th:for="'isExpress_' + ${i.index}">Giao Hỏa tốc</label> <input
														type="hidden"
														th:name="'rules[' + ${i.index} + '].isExpress'"
														value="false" />
												</div>
											</div>


										</div>
									</div>
								</div>

							</div>

							<div class="modal-footer">
								<button type="button" class="btn btn-secondary"
									data-bs-dismiss="modal"
									style="background-color: #6c757d !important; color: #fff !important; padding: 9px 19px; font-size: 1.4rem; font-weight: 500; min-width: 120px;">
									<i class="fas fa-times"></i> Hủy
								</button>
								<button type="submit" class="btn btn-primary"
									style="background-color: #0d6efd !important; color: #fff !important; padding: 9px 19px; font-size: 1.4rem; font-weight: 500; min-width: 120px;">
									<i class="fas fa-save"></i> Lưu
								</button>
							</div>
						</form>
					</div>
				</div>
			</div>
			<div class="modal fade" id="editShippingCompanyModal" tabindex="-1"
				aria-labelledby="editShippingCompanyModalLabel" aria-hidden="true">
				<div class="modal-dialog modal-lg">
					<div class="modal-content">
						<form th:action="@{/admin/shipping-companies/update}"
							method="post" th:object="${shippingCompanyToEdit}">
							<div class="modal-body">

								<h1 class="text-primary mb-3"
									style="font-size: 2rem !important; font-weight: 700 !important;">
									Chỉnh Sửa Thông tin Nhà Vận Chuyển</h1>

								<input type="hidden" th:field="*{shippingId}">

								<div class="mb-3">
									<label for="companyNameEdit" class="form-label">Tên Nhà
										Vận Chuyển:</label> <input type="text" class="form-control"
										id="companyNameEdit" th:field="*{name}" required
										placeholder="Nhập tên nhà vận chuyển..."
										style="font-size: 14px;">
								</div>

								<div class="row">
									<div class="col-md-12 mb-3">
										<label for="companyPhoneEdit" class="form-label">Số
											Điện Thoại:</label> <input type="text" class="form-control"
											id="companyPhoneEdit" th:field="*{phone}" required
											placeholder="Nhập số điện thoại liên hệ..."
											style="font-size: 14px;">
									</div>
								</div>

								<h1 class="text-primary mb-3 mt-4"
									style="font-size: 2rem !important; font-weight: 700 !important; display: flex; align-items: center;">
									Quy tắc tính phí
									<button type="button" class="btn btn-sm btn-success ms-2"
										id="btnAddRuleEdit" style="font-size: 12px;">
										<i class="fas fa-plus"></i> Thêm Quy tắc
									</button>
								</h1>

								<div id="editRulesContainer" class="border p-3 rounded">
									<div th:if="${shippingCompanyToEdit.rules != null}"
										th:each="rule, i : *{rules}"
										class="rule-entry-edit mb-3 p-3 border rounded bg-light"
										th:data-index="${i.index}">

										<div
											class="d-flex justify-content-between align-items-start mb-2">

											<input type="hidden"
												th:name="'rules[' + ${i.index} + '].ruleId'"
												th:field="*{rules[__${i.index}__].ruleId}">

											<h4 class="text-secondary" th:text="'Quy tắc #' + ${i.index}"
												style="font-size: 1.25rem; font-weight: 600;">Quy tắc
												#0</h4>

											<button type="button"
												class="btn btn-danger btn-sm btnRemoveRuleEdit"
												title="Xóa quy tắc này">
												<i class="fas fa-times"></i>
											</button>
										</div>

										<div class="row g-2">
											<div class="col-12 mb-2">
												<input type="text" class="form-control form-control-sm"
													th:name="'rules[' + ${i.index} + '].ruleName'" required
													placeholder="Tên quy tắc (VD: Phí Nội Thành)"
													style="font-size: 14px;"
													th:field="*{rules[__${i.index}__].ruleName}">
											</div>
											<div class="col-md-6 mb-2">
												<input type="text" class="form-control form-control-sm"
													th:name="'rules[' + ${i.index} + '].estimatedDeliveryTime'"
													required placeholder="TG Giao hàng (VD: 1-2 ngày)"
													style="font-size: 14px;"
													th:field="*{rules[__${i.index}__].estimatedDeliveryTime}">
											</div>
											<div class="col-md-6 mb-2">
												<input type="number" step="0.01"
													class="form-control form-control-sm"
													th:name="'rules[' + ${i.index} + '].baseFee'" required
													placeholder="Phí (VD: 35000)" style="font-size: 14px;"
													th:field="*{rules[__${i.index}__].baseFee}">
											</div>
											<div class="col-md-4">
												<input type="text" class="form-control form-control-sm"
													th:name="'rules[' + ${i.index} + '].fromRegion'" required
													placeholder="Vùng Gửi (VD: HCM)" style="font-size: 14px;"
													th:field="*{rules[__${i.index}__].fromRegion}">
											</div>
											<div class="col-md-4">
												<input type="text" class="form-control form-control-sm"
													th:name="'rules[' + ${i.index} + '].toRegion'" required
													placeholder="Vùng Nhận (VD: Hà Nội)"
													style="font-size: 14px;"
													th:field="*{rules[__${i.index}__].toRegion}">
											</div>
											<div class="col-md-4 d-flex align-items-center">
												<div class="form-check form-check-inline">
													<input class="form-check-input" type="checkbox"
														th:name="'rules[' + ${i.index} + '].isExpress'"
														th:id="'isExpressEdit_' + ${i.index}" value="true"
														th:field="*{rules[__${i.index}__].isExpress}"> <label
														class="form-check-label"
														th:for="'isExpressEdit_' + ${i.index}">Giao Hỏa
														tốc</label> <input type="hidden"
														th:name="'rules[' + ${i.index} + '].isExpress'"
														value="false" />
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>

							<div class="modal-footer">
								<button type="button" class="btn btn-secondary"
									data-bs-dismiss="modal"
									style="background-color: #6c757d !important; color: #fff !important; padding: 9px 19px; font-size: 1.4rem; font-weight: 500; min-width: 120px;">
									<i class="fas fa-times"></i> Hủy
								</button>
								<button type="submit" class="btn btn-primary"
									style="background-color: #0d6efd !important; color: #fff !important; padding: 9px 19px; font-size: 1.4rem; font-weight: 500; min-width: 120px;">
									<i class="fas fa-save"></i> Lưu
								</button>
							</div>
						</form>
					</div>
				</div>
			</div>
			<table class="table table-bordered table-striped">
				<thead>
					<tr>
						<th scope="col" style="width: 50px;">STT</th>
						<th scope="col" style="width: 150px;">Mã nhà vận chuyển</th>
						<th scope="col">Tên nhà vận chuyển</th>
						<th scope="col" style="width: 150px;">SĐT</th>
						<th scope="col" class="text-center" style="width: 120px;">
							Trạng thái HĐ</th>
						<th scope="col" class="text-center" style="width: 100px;">
							Xem chi tiết</th>
						<th scope="col" class="text-center" style="width: 70px;">Thao
							tác</th>
					</tr>
				</thead>
				<tbody>
					<tr th:each="company, iStat : ${shippingCompanies}">
						<td th:text="${iStat.index + 1}"></td>
						<td th:text="${company.shippingId}"></td>
						<td th:text="${company.name}"></td>
						<td th:text="${company.phone}"></td>
						<td class="text-center">
							<form th:id="'form-' + ${company.shippingId}"
								th:action="@{/admin/shipping-companies/{id}/toggle-status(id=${company.shippingId})}"
								method="post" style="display: inline-block;"
								class="status-toggle-form">

								<input type="hidden" name="isActiveNew"
									th:value="${!company.isActive}">

								<div
									class="form-check form-switch custom-switch-container shipping-status-switch">

									<input class="form-check-input traditional-status-toggle"
										type="checkbox" th:id="'statusSwitch' + ${company.shippingId}"
										th:checked="${company.isActive}"
										th:data-id="${company.shippingId}"
										th:data-current-active="${company.isActive}"
										style="cursor: pointer;"> <label
										class="form-check-label visually-hidden"
										th:for="'statusSwitch' + ${company.shippingId}">Trạng
										thái HĐ</label>
								</div>
							</form>
						</td>
						<td class="text-center"><a
							th:href="@{/admin/shipping-companies/{id}/rules(id=${company.shippingId})}"
							class="btn btn-info btn-lg" title="Xem Quy tắc tính phí"> <i
								class="fas fa-list-alt" style="color: black !important;"></i>
						</a></td>
						<td class="text-center action-btns"><a
							th:href="@{/admin/shipping-companies/{id}/edit(id=${company.shippingId})}"
							class="btn btn-warning btn-sm" title="Chỉnh sửa chi tiết"> <i
								class="fas fa-pencil-alt" style="color: black !important;"></i>
						</a></td>
					</tr>
				</tbody>
			</table>
		</div>

	</div>

	<div th:replace="~{admin/fragments/footer :: footer}"></div>

	<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
	<script th:src="@{/webjars/bootstrap/5.3.2/js/bootstrap.bundle.min.js}"></script>
	<script th:src="@{/assets/js/commonscript.js}"></script>
	<script type="text/template" id="ruleTemplate">
    <div class="rule-entry mb-3 p-3 border rounded bg-light" data-index="{INDEX}">
        <div class="d-flex justify-content-between align-items-start mb-2">
            
            <input type="hidden" name="rules[{INDEX}].ruleId" value=""> 

            <h4 class="text-secondary" 
                style="font-size: 1.25rem; font-weight: 600;">
                Quy tắc #{INDEX}
            </h4>
            <button type="button" class="btn btn-danger btn-sm btnRemoveRule" title="Xóa quy tắc này">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <div class="row g-2">
            <div class="col-12 mb-2">
                <input type="text" class="form-control form-control-sm"
                    name="rules[{INDEX}].ruleName" required
                    placeholder="Tên quy tắc (VD: Phí Nội Thành)" style="font-size: 14px;">
            </div>
            
            <div class="col-md-6 mb-2">
                <input type="text" class="form-control form-control-sm"
                    name="rules[{INDEX}].estimatedDeliveryTime" required
                    placeholder="TG Giao hàng (VD: 1-2 ngày)" style="font-size: 14px;">
            </div>

            <div class="col-md-6 mb-2">
                <input type="number" step="0.01" class="form-control form-control-sm"
                    name="rules[{INDEX}].baseFee" required
                    placeholder="Phí (VD: 35000)" style="font-size: 14px;">
            </div>
            
            <div class="col-md-4">
                <input type="text" class="form-control form-control-sm"
                    name="rules[{INDEX}].fromRegion" required
                    placeholder="Vùng Gửi (VD: HCM)" style="font-size: 14px;">
            </div>
            
            <div class="col-md-4">
                <input type="text" class="form-control form-control-sm"
                    name="rules[{INDEX}].toRegion" required
                    placeholder="Vùng Nhận (VD: Hà Nội)" style="font-size: 14px;">
            </div>

            <div class="col-md-4 d-flex align-items-center">
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="checkbox"
                        name="rules[{INDEX}].isExpress" id="isExpress_{INDEX}" value="true">
                    <label class="form-check-label" for="isExpress_{INDEX}">Giao Hỏa tốc</label>
                    
                    <input type="hidden" name="rules[{INDEX}].isExpress" value="false" />
                </div>
            </div>
        </div>
    </div>
</script>
	<script th:inline="javascript">
        // Biến này sẽ là true nếu nó được Flash Attribute từ showEditForm
        const openEditModal = [[${openEditModal} == true]];
    </script>
	<script th:src="@{/assets/js/admin/shipping_company.js}"></script>

</body>

</html>