<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title layout:title-pattern="$CONTENT_TITLE - $LAYOUT_TITLE">OneShop Admin Dashboard</title>

    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <!-- Vendor CSS -->
    <link rel="stylesheet" th:href="@{/assets/css/vendor.css}">

    <th:block layout:fragment="css">
        <style>
            /* Ghi đè màu active menu */
            #sidebar-wrapper .list-group-item-action.active {
                background-color: #E85A70 !important;
                border-color: #E85A70 !important;
                color: white !important;
                border-left: none !important;
            }
        </style>
    </th:block>
</head>
<body>
<div class="d-flex" id="wrapper">
    <!-- Sidebar -->
    <div id="sidebar-wrapper">
        <div class="sidebar-heading">OneShop Admin</div>
        <div class="list-group list-group-flush">
            <a th:href="@{/admin/users}"
               class="list-group-item list-group-item-action"
               th:classappend="${currentPage == 'admin-users'} ? 'active' : ''">
                <i class="fas fa-users-cog me-2"></i>Quản lý người dùng
            </a>
            <a th:href="@{/admin/shipper/create}"
               class="list-group-item list-group-item-action"
               th:classappend="${currentPage == 'admin-create-shipper'} ? 'active' : ''">
                <i class="fas fa-truck-moving me-2"></i>Tạo Tài khoản Shipper
            </a>
            <a th:href="@{/admin/shops}"
               class="list-group-item list-group-item-action"
               th:classappend="${currentPage == 'admin-shops'} ? 'active' : ''">
                <i class="fas fa-store me-2"></i>Quản lý Shop
            </a>
            <a th:href="@{/admin/categories}"
               class="list-group-item list-group-item-action"
               th:classappend="${currentPage == 'admin-categories'} ? 'active' : ''">
                <i class="fas fa-sitemap me-2"></i>Quản lý danh mục
            </a>
            <a th:href="@{/admin/promotions}"
               class="list-group-item list-group-item-action"
               th:classappend="${currentPage == 'admin-promotions'} ? 'active' : ''">
                <i class="fas fa-tags me-2"></i>Quản lý Khuyến mãi
            </a>
            <a th:href="@{/admin/promotion-types}"
               class="list-group-item list-group-item-action"
               th:classappend="${currentPage == 'admin-promotion-types'} ? 'active' : ''">
                <i class="fas fa-cogs me-2"></i>Quản lý Loại Khuyến mãi
            </a>
            <a th:href="@{/admin/app-discounts}"
               class="list-group-item list-group-item-action"
               th:classappend="${currentPage == 'admin-discounts'} ? 'active' : ''">
                <i class="fas fa-percent me-2"></i>Quản lý chiết khấu
            </a>
            <a th:href="@{/admin/shipping_company}"
               class="list-group-item list-group-item-action"
               th:classappend="${currentPage == 'admin-shipping'} ? 'active' : ''">
                <i class="fas fa-shipping-fast me-2"></i>Quản lý nhà vận chuyển
            </a>

            <hr style="border-top: 1px solid rgba(255,255,255,.1);">
            <a th:href="@{/}" class="list-group-item list-group-item-action">
                <i class="fas fa-home me-2"></i>Quay lại trang chủ
            </a>
        </div>
    </div>

    <!-- Page Content -->
    <div id="page-content-wrapper">
        <nav class="navbar navbar-expand-lg navbar-light">
            <div class="container-fluid">
                <button class="btn btn-primary" id="menu-toggle">
                    <i class="fas fa-bars"></i>
                </button>

                <button class="navbar-toggler" type="button"
                        data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent"
                        aria-controls="navbarSupportedContent" aria-expanded="false"
                        aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <div class="collapse navbar-collapse" id="navbarSupportedContent">
                    <ul class="navbar-nav ms-auto mt-2 mt-lg-0">
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown"
                               role="button" data-bs-toggle="dropdown" aria-expanded="false">
                                <i class="fas fa-user-shield me-1"></i>
                                <span sec:authentication="name">Tên Admin</span>
                            </a>
                            <div class="dropdown-menu dropdown-menu-end" aria-labelledby="navbarDropdown">
                                <a class="dropdown-item" href="javascript:void(0);"
                                   onclick="document.getElementById('logoutForm').submit();">Đăng xuất</a>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>

        <main class="container-fluid p-4" layout:fragment="content">
            <!-- Nội dung trang con sẽ vào đây -->
        </main>
    </div>
</div>

<!-- Logout Form -->
<form id="logoutForm" th:action="@{/logout}" method="post" style="display: none;"></form>

<!-- =================== JS: jQuery + Bootstrap 5 =================== -->
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
$(document).ready(function () {
    // Kiểm tra Bootstrap
    if (typeof bootstrap === 'undefined') {
        console.error('BOOTSTRAP KHÔNG ĐƯỢC LOAD!');
    } else {
        console.log('Bootstrap loaded thành công!');
    }

    // Sidebar toggle
    $('#menu-toggle').on('click', function (e) {
        e.preventDefault();
        $('#wrapper').toggleClass('toggled');
    });

    // Tự đóng alert
    $('.alert').each(function () {
        setTimeout(() => {
            const bsAlert = bootstrap.Alert.getInstance(this);
            if (bsAlert) bsAlert.close();
            else $(this).alert('close');
        }, 5000);
    });
});
</script>

<!-- Script riêng của trang con -->
<th:block layout:fragment="js"></th:block>
<!-- =================== KẾT THÚC JS =================== -->
</body>
</html>