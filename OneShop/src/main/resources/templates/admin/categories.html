<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Quản lý Danh mục - Admin</title>
<link rel="preconnect" href="https://fonts.gstatic.com">
<link
	href="https://fonts.googleapis.com/css2?family=Roboto+Slab:wght@100;200;300;400;500;600;700;800;900&display=swap"
	rel="stylesheet">
<link rel="stylesheet"
	href="https://pro.fontawesome.com/releases/v5.10.0/css/all.css"
	integrity="sha384-AYmEC3Yw5cVb3ZcuHtOA93w35dYTsvhLPVnYs9eStHfGJvOvKxVfELGroGkvsg+p"
	crossorigin="anonymous" />
<link rel="stylesheet"
	th:href="@{/webjars/bootstrap/5.3.2/css/bootstrap.min.css}" />
<link rel="stylesheet" th:href="@{/assets/css/library.css}">
<link rel="stylesheet" th:href="@{/assets/css/common.css}">
<link rel="stylesheet" th:href="@{/assets/css/admin/user.css}">
</head>

<body>

	<div th:replace="~{admin/fragments/header :: header}"></div>

	<div class="main admin-container">
		<div class="grid wide">
			<div class="breadcrumb-admin-static" style="padding: 20px 0;">
				<span class="breadcrumb-item-admin"
					style="font-weight: 500; text-transform: uppercase;">ADMIN</span> <span
					style="font-weight: 500; margin: 0 5px;">/</span> <span
					class="breadcrumb-item-admin"
					style="font-weight: 500; text-transform: uppercase;">QUẢN LÝ
					DANH MỤC</span>
			</div>
			<div class="d-flex justify-content-end mb-3">
				<button type="button" class="btn btn-primary" data-bs-toggle="modal"
					data-bs-target="#addCategoryModal" id="btnAddCategory"
					style="background-color: #0d6efd !important; color: #fff !important; font-size: 16px; font-weight: 600; padding: 8px 15px;">
					<i class="fas fa-plus"></i> Thêm Danh Mục
				</button>
			</div>

			<div class="modal fade" id="addCategoryModal" tabindex="-1"
				aria-labelledby="addCategoryModalLabel" aria-hidden="true">
				<div class="modal-dialog">
					<div class="modal-content">
						<div class="modal-header">
							<h5 class="modal-title" id="addCategoryModalLabel"
								style="font-size: 2rem; font-weight: 700; color: #0d6efd;">Thêm
								Danh Mục Mới</h5>
							<button type="button" class="btn-close" data-bs-dismiss="modal"
								aria-label="Close"></button>
						</div>

						<form th:action="@{/admin/categories/save}" method="post"
							th:object="${newCategory}">
							<div class="modal-body">

								<div class="mb-3">
									<label for="categoryName" class="form-label">Tên Danh
										Mục:</label> <input type="text" class="form-control" id="categoryName"
										th:field="*{name}" required placeholder="Nhập tên danh mục..."
										style="font-size: 14px;">
								</div>

								<div class="mb-3">
									<label for="parentCategory" class="form-label">Danh Mục
										Cha (Tùy chọn):</label> <select class="form-select"
										id="parentCategory" th:field="*{parentCategory.categoryId}"
										style="font-size: 14px;">
										<option value="">-- Chọn danh mục cha --</option>
										<option th:each="cat : ${allCategories}"
											th:value="${cat.categoryId}" th:text="${cat.name}">Tên
											Danh Mục Cha</option>
									</select>
								</div>

							</div>

							<div class="modal-footer">
								<button type="button" class="btn btn-secondary"
									data-bs-dismiss="modal"
									style="background-color: #6c757d !important; color: #fff !important; padding: 9px 19px; font-size: 1.4rem; font-weight: 500; min-width: 120px;">
									<i class="fas fa-times"></i> Hủy
								</button>
								<button type="submit" class="btn btn-primary"
									style="background-color: #0d6efd !important; color: #fff !important; padding: 9px 19px; font-size: 1.4rem; font-weight: 500; min-width: 120px;">
									<i class="fas fa-save"></i> Lưu
								</button>
							</div>
						</form>
					</div>
				</div>
			</div>

			<div class="modal fade" id="editCategoryModal" tabindex="-1"
				aria-labelledby="editCategoryModalLabel" aria-hidden="true">
				<div class="modal-dialog">
					<div class="modal-content">
						<div class="modal-header">
							<h5 class="modal-title" id="editCategoryModalLabel"
								style="font-size: 2rem; font-weight: 700; color: #ffc107;">Chỉnh
								Sửa Danh Mục</h5>
							<button type="button" class="btn-close" data-bs-dismiss="modal"
								aria-label="Close"></button>
						</div>

						<form th:action="@{/admin/categories/save}" method="post"
							th:object="${editCategory}">
							<div class="modal-body">
								<input type="hidden" th:field="*{categoryId}" />

								<div class="mb-3">
									<label for="editCategoryName" class="form-label">Tên
										Danh Mục:</label> <input type="text" class="form-control"
										id="editCategoryName" th:field="*{name}" required
										placeholder="Nhập tên danh mục..." style="font-size: 14px;">
								</div>

								<div class="mb-3">
									<label for="editParentCategory" class="form-label">Danh
										Mục Cha (Tùy chọn):</label> <select class="form-select"
										id="editParentCategory"
										th:field="*{parentCategory.categoryId}"
										style="font-size: 14px;">
										<option value="">-- Chọn danh mục cha --</option>
										<option th:each="cat : ${eligibleParentCategories}"
											th:value="${cat.categoryId}" th:text="${cat.name}">Tên
											Danh Mục Cha</option>
									</select>
								</div>

							</div>

							<div class="modal-footer">
								<button type="button" class="btn btn-secondary"
									data-bs-dismiss="modal"
									style="background-color: #6c757d !important; color: #fff !important; padding: 9px 19px; font-size: 1.4rem; font-weight: 500; min-width: 120px;">
									<i class="fas fa-times"></i> Hủy
								</button>
								<button type="submit" class="btn btn-primary"
									style="background-color: #ffc107 !important; color: #000 !important; padding: 9px 19px; font-size: 1.4rem; font-weight: 500; min-width: 120px;">
									<i class="fas fa-save"></i> Cập Nhật
								</button>
							</div>
						</form>
					</div>
				</div>
			</div>
			<table class="table table-bordered table-striped">
				<thead>
					<tr>
						<th scope="col">STT</th>
						<th scope="col">Mã Danh Mục</th>
						<th scope="col">Tên Danh Mục</th>
						<th scope="col">Danh Mục Cha</th>
						<th scope="col" class="text-center" style="width: 150px;">
							Xem chi tiết</th>
						<th scope="col" class="text-center" style="width: 120px;">Thao
							tác</th>
					</tr>
				</thead>
				<tbody>
					<tr th:each="category, iterStat : ${categories}">
						<td th:text="${iterStat.count}"></td>

						<td th:text="${category.categoryId}"></td>

						<td th:text="${category.name}"></td>

						<td
							th:text="${category.parentCategory != null ? category.parentCategory.name : ''}"></td>

						<td class="text-center"><a
							th:href="@{/admin/categories/{id}/detail(id=${category.categoryId})}"
							class="btn btn-sm btn-info" title="Xem chi tiết"> <i
								class="fas fa-eye"></i>
						</a></td>

						<td class="text-center"><a
							th:href="@{/admin/categories/{id}/edit(id=${category.categoryId})}"
							class="btn btn-sm btn-warning btn-edit" title="Chỉnh sửa"> <i
								class="fas fa-pencil-alt" style="color: black !important;"></i>
						</a> <a
							th:href="@{/admin/categories/{id}/delete(id=${category.categoryId})}"
							class="btn btn-warning btn-sm"
							onclick="return confirm('Bạn có chắc chắn muốn xóa danh mục này không?')"
							title="Xóa sản phẩm"> <i class="fas fa-trash"
								style="color: black !important;"></i>
						</a></td>
					</tr>
				</tbody>
			</table>
		</div>

	</div>

	<div th:replace="~{admin/fragments/footer :: footer}"></div>

	<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
	<script th:src="@{/webjars/bootstrap/5.3.2/js/bootstrap.bundle.min.js}"></script>
	<script th:src="@{/assets/js/commonscript.js}"></script>
	<script th:if="${isEditing}">
		$(document).ready(
				function() {
					var editModal = new bootstrap.Modal(document
							.getElementById('editCategoryModal'));
					editModal.show();
				});
	</script>
	<script th:src="@{/assets/js/admin/categories.js}"></script>

</body>

</html>